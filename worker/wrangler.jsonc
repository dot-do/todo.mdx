{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "todo-mdx",
  "account_id": "b6641681fe423910342b9ffa1364c76d", // .do account
  "main": "src/index.ts",
  "compatibility_date": "2024-12-01",
  "compatibility_flags": ["nodejs_compat"],

  // Custom domain routes - MCP OAuth at root, API under paths
  "routes": [
    { "pattern": "todo.mdx.do/.well-known/*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/authorize*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/token*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/register*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/callback*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/sse*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/mcp*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/api/*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/github/*", "zone_name": "mdx.do" },
    { "pattern": "todo.mdx.do/linear/*", "zone_name": "mdx.do" }
  ],

  // Workers AI for voice and embeddings
  "ai": {
    "binding": "AI"
  },

  // Vectorize for semantic search
  "vectorize": [
    {
      "binding": "VECTORIZE",
      "index_name": "todo-embeddings"
    }
  ],

  // D1 Database for app installs and DO registry
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "todo-mdx",
      "database_id": "7773cb8c-af79-4ae9-8473-342acbbc0444",
      "migrations_dir": "migrations"
    }
  ],

  // Durable Objects
  "durable_objects": {
    "bindings": [
      { "name": "REPO", "class_name": "RepoDO" },
      { "name": "PROJECT", "class_name": "ProjectDO" },
      { "name": "MCP_OBJECT", "class_name": "TodoMCP" }
    ]
  },

  "migrations": [
    {
      "tag": "v1",
      "new_sqlite_classes": ["RepoDO", "ProjectDO"]
    },
    {
      "tag": "v2",
      "new_sqlite_classes": ["TodoMCP"]
    }
  ],

  // Cloudflare Workflows
  "workflows": [
    {
      "binding": "DEVELOP_WORKFLOW",
      "name": "develop-workflow",
      "class_name": "DevelopWorkflow"
    },
    {
      "binding": "EMBED_WORKFLOW",
      "name": "embed-workflow",
      "class_name": "EmbedWorkflow"
    },
    {
      "binding": "BULK_EMBED_WORKFLOW",
      "name": "bulk-embed-workflow",
      "class_name": "BulkEmbedWorkflow"
    }
  ],

  // Service Bindings - Payload RPC
  "services": [
    {
      "binding": "PAYLOAD",
      "service": "admin-todo-mdx",
      "entrypoint": "PayloadRPC"
    }
  ],

  // KV namespace for OAuth state (Linear OAuth)
  "kv_namespaces": [
    {
      "binding": "OAUTH_KV",
      "id": "5602c4ff6e3249b684e5c8eaea0b1901"
    }
  ],

  // Environment variables (set via wrangler secret)
  // GitHub App: GITHUB_APP_ID, GITHUB_PRIVATE_KEY, GITHUB_WEBHOOK_SECRET
  // WorkOS AuthKit: WORKOS_CLIENT_ID, WORKOS_CLIENT_SECRET, COOKIE_ENCRYPTION_KEY
  // Linear: LINEAR_CLIENT_ID, LINEAR_CLIENT_SECRET, LINEAR_WEBHOOK_SECRET
  // AI: ANTHROPIC_API_KEY
}
